#!/bin/sh

usage() {
    echo "Usage: cjdrouted [start|stop|reconfigure|start-default|killtunnel]"
}

if [ "$1" = "start" ]; then
    cjconf-make
    cjdinfo commands | sh
    cjdlog make
    echo "Starting cjdroute..."
    sudo su cjdns -c \
      "cjdroute < /etc/cjdroute.conf 2>&1 | cjdlog &"
elif [ "$1" = "stop" ]; then
    killall cjdroute
elif [ "$1" = "reconfigure" ]; then
    cjdrouted stop
    cjdrouted start
elif [ "$1" = "start-default" ]; then
    cjconf-make
    cjconf-add-default
    cjdrouted start
elif [ "$1" = "killtunnel" ]; then
    # Remove the current tunnel
    TUNID="`cjdinfo tunnel`"
    echo "Killing tunnel $TUNID"
    /sbin/ip tuntap del mode tun $TUNID
else
    usage
fi
